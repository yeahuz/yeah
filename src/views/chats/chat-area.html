<% const distinct_dates = new Map() %>
<section class="border-l border-l-gray-200 dark:border-l-zinc-800 w-full">
  <% if (it.chat) { %>
    <header class="flex justify-between w-full dark:bg-zinc-900 p-4 shadow-lg dark:drop-shadow-lg">
      <div class="flex space-x-2 items-center">
        <img src="http://localhost:3000/avatars?name=Juraev Avazbek" class="w-12 h-12 rounded-full overflow-hidden" alt="" />
        <div class="flex flex-col">
          <span class="text-gray-700 dark:text-gray-200 font-medium">Andi Lane</span>
          <span class="text-gray-500 dark:text-gray-300">@andi</span>
        </div>
      </div>
      <div>
        <a href="/users/user-id" class="btn btn-md btn-primary">View profile</a>
      </div>
    </header>
    <div class="flex flex-col space-y-6">
      <ul class="overflow-y-auto space-y-1 flex-1 max-h-[42rem] p-4">
        <% it.chat.messages.forEach(function (message) { %>
          <% const yyyymmdd = new Date(message.created_at).toISOString().split("T")[0] %>
          <% const existing = distinct_dates.has(yyyymmdd) %>
          <% if (!existing) distinct_dates.set(yyyymmdd, 1) %>
          <% if (!existing) {%>
            <div class="text-center py-4">
              <span class="inline-block text-xs text-gray-400 bg-zinc-800 px-3 py-1 rounded-full">
                <%= yyyymmdd %>
              </span>
            </div>
          <% } %>
          <li class="py-2.5 px-3 rounded-lg block relative max-w-max <%= message.is_own_message ? "ml-auto text-white bg-primary-600" : "mr-auto text-gray-900 bg-gray-100 dark:text-white dark:bg-zinc-800" %>">
            <p>
              <%= message.content %>
            </p>
            <span class="block text-right text-xs mt-0.5 <%= message.is_own_message ? "text-primary-50" : "text-gray-500 dark:text-gray-300" %>">
              <%= it.formatter.format(new Date(message.created_at)) %>
            </span>
          </li>
        <% }) %>
      </ul>
      <form method="post" action="/chats/hash-id" class="flex items-center space-x-2 px-4 pb-4">
        <div>
          <label for="files" class="text-gray-700 dark:text-gray-300 block p-3 -ml-3 cursor-pointer">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21.1525 10.8995L12.1369 19.9151C10.0866 21.9653 6.7625 21.9653 4.71225 19.9151C2.662 17.8648 2.662 14.5407 4.71225 12.4904L13.7279 3.47483C15.0947 2.108 17.3108 2.108 18.6776 3.47483C20.0444 4.84167 20.0444 7.05775 18.6776 8.42458L10.0156 17.0866C9.33213 17.7701 8.22409 17.7701 7.54068 17.0866C6.85726 16.4032 6.85726 15.2952 7.54068 14.6118L15.1421 7.01037" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </label>
          <input type="file" name="files" id="files" value="" class="hidden" />
        </div>
        <elastic-textarea style="display: inline-flex"><textarea class="form-control" name="content" id="" rows="1" cols="100" tabindex=""></textarea></elastic-textarea>
        <button class="btn btn-primary btn-lg">Send</button>
      </form>
    </div>
  <% } else { %>
    <div class="flex items-center justify-center h-full">
      <h3 class="text-gray-700 dark:text-gray-200 text-xl font-medium"><%= it.t("select_to_see", { ns: "chats" })%></h3>
    </div>
  <% } %>
</section>
</div>
</main>
<script defer async type="module" src="/public/js/elastic-textarea.js"></script>
